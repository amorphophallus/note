# 服务器数据迁移

*-- from Bandwagon to cloud.Tencent*

## 搬运内容

1. 在腾讯云服务器中新建用户
    1. `useradd`
    2. 配置 sudo 免密码 + `passwd` + ssh 免密码
    3. 修改 hostname
2. 用 scp 搬运文件
    1. 把原用户文件夹（root 文件夹） `scp` 过去
    2. 修改全局配置
3. 安装需要的环境
    1. docker + docker-compose
    2. caddy
    3. 修改域名解析
    4. 重启所有的 docker 容器
    5. `caddy start`

修改过的全局配置：

1. `\etc\profile`
3. `\etc\caddy`

在新服务器上需要重新修改的配置：

1. `\etc\sudoers.d` 文件夹
2. `~/.bashrc` 如果从 root 用户复制到普通用户，记得修改
3. 在 vscode 和 windows terminal 的 ssh_config 里写入新的服务器信息

配置过的环境：

1. `git`（apt-get）
2. `Docker`
2. `caddy`
3. `mkdocs-material` + 插件（用 pip 安装）

## 后记

不同运营商的服务器之间基本没有方便的传输方法，所以最方便服务器迁移的方法还是把所有文件都放在 **用户文件夹** 下，配置文件也尽量只修改用户自己的，最后记录一下修改过的全局配置。

记录一下出的一个小问题，`mv` 不加参数默认直接覆盖，我把原来 `root` 用户的文件全部复制到新服务器普通用户的文件夹下，配置也变成了 `root` 用户的配置，没有高亮显示，很难受。解决办法也很简单，再新建一个用户，把那个用户的配置文件复制过来就好了。

并且文件权限也是一个问题。我把 root 的文件复制到普通用户的文件夹下，还需要修改权限才能不用 sudo 访问。

然后配置的语言上有些好习惯可以从现在培养起来，比如说用 **127.0.0.1** 而不是直接用域名，在用户文件夹下的目录就用 **~** 不要用 /home/username，这样就算换服务器，换用户名，配置也是不用改的。

对于 docker 也是同理，最好所有容器都只需要一句 `docker-compose up -d` 就可以部署完成，然后把左右部署需要用到的命令放在 `deploy.sh` 里，就可以 **一键部署** 了。还可以把所有动态修改的数据都 **挂载** 到外部，直接搬运整个文件夹避免重新配置。